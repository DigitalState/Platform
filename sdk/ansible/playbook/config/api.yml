---
- name: Obtain api container ip
  hosts: server
  become: true
  tasks:
      - name: Test
        shell: docker inspect --format '{{ '{{' }} .NetworkSettings.Networks.api_default.IPAddress {{ '}}' }}' api_api_proxy_1
        register: ip

- name: Set host config to api container ip
  hosts: server
  become: true
  vars:
      config:
          ds_api.api.assets.host: 'http://{{ ip.stdout }}'
          ds_api.api.authentication.host: 'http://{{ ip.stdout }}'
          ds_api.api.cases.host: 'http://{{ ip.stdout }}'
          ds_api.api.cms.host: 'http://{{ ip.stdout }}'
          ds_api.api.identities.host: 'http://{{ ip.stdout }}'
          ds_api.api.records.host: 'http://{{ ip.stdout }}'
          ds_api.api.services.host: 'http://{{ ip.stdout }}'
          ds_api.api.tasks.host: 'http://{{ ip.stdout }}'
          ds_api.api.camunda.host: 'http://{{ ip.stdout }}/engine-rest'
          ds_api.api.formio.host: 'http://{{ ip.stdout }}'
  roles:
      - { role: service/assets/config/set, when: assets is not none }
      - { role: service/authentication/config/set, when: authentication is not none }
      - { role: service/cases/config/set, when: cases is not none }
      - { role: service/cms/config/set, when: cms is not none }
      - { role: service/identities/config/set, when: identities is not none }
      - { role: service/records/config/set, when: records is not none }
      - { role: service/services/config/set, when: services is not none }
      - { role: service/tasks/config/set, when: tasks is not none }
